---
import Layout from '../layouts/Layout.astro';
import Hero from '../components/ui/Hero.astro';
import Section from '../components/ui/Section.astro';
import Card from '../components/ui/Card.astro';
import Badge from '../components/ui/Badge.astro';
import Button from '../components/ui/Button.astro';

// AUTOMATION: Fetch and sort reports
const allReports = await Astro.glob('./reports/*.md');
const sortedReports = allReports.sort((a, b) => new Date(b.frontmatter.date).valueOf() - new Date(a.frontmatter.date).valueOf());

const getCategoryColor = (category) => {
  if (category === 'Fund Analysis') return 'bg-navy/10 text-navy';
  if (category === 'Category Comparison') return 'bg-gold/10 text-gold-dark';
  if (category === 'Methodology') return 'bg-gray-100 text-gray-500';
  return 'bg-blue-50 text-blue-600';
};
---

<Layout title="Analysis Reports - Fund Investigator" description="In-depth mutual fund analysis reports.">
  <Hero size="md">
    <h1 class="text-5xl md:text-6xl font-bold text-navy mb-6 leading-tight">Analysis Reports</h1>
    <p class="text-xl md:text-2xl text-gray-600 max-w-2xl mx-auto font-light leading-relaxed">In-depth research on mutual fund performance, risk patterns, and portfolio trends.</p>
  </Hero>

  <Section background="white" spacing="lg" maxWidth="xl">
    <div class="flex flex-wrap gap-3 mb-12 justify-center" id="filter-container">
      <button class="filter-btn px-4 py-2 rounded-full text-sm font-medium transition-all bg-navy text-white hover:opacity-90 active" data-filter="all">All Reports</button>
      <button class="filter-btn px-4 py-2 rounded-full text-sm font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200" data-filter="Fund Analysis">Fund Analysis</button>
      <button class="filter-btn px-4 py-2 rounded-full text-sm font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200" data-filter="Category Comparison">Comparisons</button>
      <button class="filter-btn px-4 py-2 rounded-full text-sm font-medium transition-all bg-gray-100 text-gray-600 hover:bg-gray-200" data-filter="Methodology">Methodology</button>
    </div>

    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8" id="reports-grid">
      {sortedReports.map((report) => (
        <div class="report-item" data-category={report.frontmatter.category}>
          <a href={report.url} class="block h-full">
            <Card padding="none" class="group h-full hover:shadow-lg transition-all duration-300">
              <div class={`h-48 flex items-center justify-center transition-colors ${getCategoryColor(report.frontmatter.category)}`}>
                <svg class="w-16 h-16 opacity-30" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
              </div>
              <div class="p-6">
                <div class="mb-3"><Badge>{report.frontmatter.category}</Badge></div>
                <h2 class="text-xl font-bold text-navy mb-3 leading-snug group-hover:text-gold transition-colors">{report.frontmatter.title}</h2>
                <p class="text-gray-600 text-sm mb-4 leading-relaxed line-clamp-3">{report.frontmatter.description}</p>
                <div class="flex items-center justify-between text-xs text-gray-500 mb-4">
                  <time>{new Date(report.frontmatter.date).toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</time>
                  <span>{report.frontmatter.readTime}</span>
                </div>
                <div class="flex flex-wrap gap-2">
                  {report.frontmatter.tags && report.frontmatter.tags.map((tag) => (<Badge variant="secondary" size="sm">{tag}</Badge>))}
                </div>
              </div>
            </Card>
          </a>
        </div>
      ))}
    </div>
    
    <div class="mt-16 text-center">
        </div>
  </Section>
</Layout>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const buttons = document.querySelectorAll('.filter-btn');
    const items = document.querySelectorAll('.report-item');
    buttons.forEach(btn => {
      btn.addEventListener('click', () => {
        buttons.forEach(b => { b.classList.remove('bg-navy', 'text-white'); b.classList.add('bg-gray-100', 'text-gray-600'); });
        btn.classList.remove('bg-gray-100', 'text-gray-600'); btn.classList.add('bg-navy', 'text-white');
        const filterValue = btn.getAttribute('data-filter');
        items.forEach(item => {
          if (filterValue === 'all' || item.getAttribute('data-category') === filterValue) {
            item.classList.remove('hidden'); item.classList.add('block', 'animate-fade-in');
          } else {
            item.classList.add('hidden'); item.classList.remove('block', 'animate-fade-in');
          }
        });
      });
    });
  });
</script>